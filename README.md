# AI Travel Planner (Web)

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ Web ç‰ˆ AI æ—…è¡Œè§„åˆ’å¸ˆï¼ŒåŒ…å«å‰ç«¯ï¼ˆNext.jsï¼‰ä¸åç«¯ï¼ˆAPI è·¯ç”±ï¼‰ï¼Œæ”¯æŒè¯­éŸ³è¾“å…¥ã€æ™ºèƒ½è¡Œç¨‹ç”Ÿæˆã€é¢„ç®—ä¼°ç®—ã€åœ°å›¾å±•ç¤ºï¼ˆé«˜å¾·åœ°å›¾ï¼‰ï¼Œä»¥åŠ Supabase äº‘ç«¯åŒæ­¥è¡Œç¨‹ä¸è´¹ç”¨è®°å½•ã€‚

## âœ¨ æœ€æ–°åŠŸèƒ½æ›´æ–°

- **æ™ºèƒ½æŒ‰æ—¥é«˜äº®**ï¼šé€‰æ‹©æŸä¸€å¤©åè‡ªåŠ¨éšè—å…¶ä»–å¤©è·¯çº¿ï¼Œæ¸…æ™°å±•ç¤ºå½“æ—¥è¡Œç¨‹
- **ä¼˜é›…å¯¼èˆªä½“éªŒ**ï¼šçª„å¯¼èˆªæ æ”¯æŒé¼ æ ‡æ‚¬åœè‡ªåŠ¨å±•å¼€ï¼Œå¸¦æœ‰çŠ¶æ€é¢œè‰²çš„æ–‡å­—æç¤ºæ°”æ³¡
- **ç²¾å‡†åŸå¸‚åŒ¹é…**ï¼šæ”¹è¿› POI åœ°ç†ç¼–ç é€»è¾‘ï¼Œç¡®ä¿ç›®çš„åœ°ä¸æ ‡æ³¨ç²¾ç¡®åŒ¹é…ï¼Œæ”¯æŒè‹±æ–‡åŸå¸‚åç§°
- **Docker è‡ªåŠ¨åŒ–**ï¼šå®Œæ•´çš„ GitHub Actions CI/CD æµæ°´çº¿ï¼Œè‡ªåŠ¨æ„å»ºå¹¶æ¨é€é•œåƒåˆ°é˜¿é‡Œäº‘ ACR

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

- **è¯­éŸ³è¾“å…¥è¯†åˆ«** - æµè§ˆå™¨å½•éŸ³ï¼Œæ”¯æŒå®æ—¶è¯­éŸ³è½¬æ–‡æœ¬
- **æ™ºèƒ½è¡Œç¨‹è§„åˆ’** - åŸºäºç›®çš„åœ°çš„å¤šå¤©è¡Œç¨‹è‡ªåŠ¨ç”Ÿæˆ
- **ç²¾å‡†é¢„ç®—ä¼°ç®—** - æ ¹æ®è¡Œç¨‹å†…å®¹æ™ºèƒ½è®¡ç®—æ—…è¡Œé¢„ç®—
- **äº¤äº’å¼åœ°å›¾** - é«˜å¾·åœ°å›¾é›†æˆï¼Œæ˜¾ç¤º POI æ ‡æ³¨å’Œè·¯çº¿è§„åˆ’
- **æŒ‰æ—¥é«˜äº®å±•ç¤º** - é€‰æ‹©ç‰¹å®šæ—¥æœŸï¼Œéšè—å…¶ä»–å¤©è·¯çº¿ï¼Œæ¸…æ™°æŸ¥çœ‹å½“æ—¥è¡Œç¨‹
- **äº‘ç«¯æ•°æ®åŒæ­¥** - Supabase å®æ—¶åŒæ­¥è¡Œç¨‹ä¸è´¹ç”¨è®°å½•
- **å“åº”å¼å¯¼èˆª** - çª„å¯¼èˆªæ æ‚¬åœå±•å¼€ï¼Œæ™ºèƒ½æ–‡å­—æç¤º
- **Docker å®¹å™¨åŒ–** - å®Œæ•´çš„å®¹å™¨éƒ¨ç½²æ”¯æŒï¼Œè‡ªåŠ¨åŒ– CI/CD æµæ°´çº¿

## ç¯å¢ƒå˜é‡

å‚è€ƒ `.env.example`ï¼Œåœ¨æœ¬åœ°åˆ›å»º `.env` å¹¶å¡«å…¥ï¼ˆå‰ç«¯ä¸åç«¯å‡éœ€é…ç½® Supabaseï¼‰ï¼š

```
APPID=
SPEECH_API_KEY=
SPEECH_API_SECRET=

MAPS_API_KEY=
MAPS_PROVIDER=gaode
NEXT_PUBLIC_MAPS_API_KEY=
NEXT_PUBLIC_AMAP_SECURITY_JS_CODE=

AccessKey=
LLM_API_KEY=
LLM_PROVIDER=aliyun

SUPABASE_URL=
SUPABASE_ANON_KEY=
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
# å¯é€‰ï¼šæœ¬åœ°ç­–ç•¥æ£€æŸ¥è„šæœ¬ä½¿ç”¨
SUPABASE_SERVICE_ROLE_KEY=
```

æ³¨æ„ï¼šä¸è¦åœ¨ä»“åº“ä¸­æäº¤ä»»ä½•çœŸå®çš„å¯†é’¥ã€‚éƒ¨ç½²æ—¶é€šè¿‡ç¯å¢ƒæ³¨å…¥ï¼Œæˆ–åœ¨è®¾ç½®é¡µè¾“å…¥ã€‚

æç¤ºï¼šå½“ `.env`/`.env.local` ä¸­å·²æ­£ç¡®é…ç½® Supabaseï¼ˆæœåŠ¡ç«¯ä¸å‰ç«¯å˜é‡å‡è®¾ç½®ï¼‰æ—¶ï¼Œåº”ç”¨é»˜è®¤å¯ç”¨â€œäº‘åŒæ­¥â€ã€‚è‹¥ç¼ºå¤±ç›¸å…³å˜é‡ï¼Œåˆ™è‡ªåŠ¨å›é€€åˆ°å†…å­˜å­˜å‚¨ï¼Œä»…ç”¨äºå¼€å‘è°ƒè¯•ï¼ˆåˆ·æ–°åä¸ä¿ç•™æ•°æ®ï¼‰ã€‚

## æœ¬åœ°è¿è¡Œ

```bash
npm install
npm run dev
# æ‰“å¼€ http://localhost:3000
```

## Docker æ„å»ºä¸è¿è¡Œ

```bash
docker build -t ai-travel-planner:latest .
docker run --env-file ./.env -p 3000:3000 ai-travel-planner:latest
```

### ç›´æ¥ä¸‹è½½é•œåƒæ–‡ä»¶ï¼ˆæ— éœ€ç™»å½•é•œåƒä»“åº“ï¼‰

åœ¨æ¯æ¬¡ CI è¿è¡Œåï¼ŒGitHub Actions ä¼šä¸Šä¼ å¯ä¸‹è½½çš„é•œåƒæ–‡ä»¶ï¼ˆ`.tar`ï¼‰ï¼š

- è¿›å…¥ä»“åº“çš„ `Actions` > é€‰æ‹©æœ€è¿‘ä¸€æ¬¡å·¥ä½œæµ > `Artifacts`
- ä¸‹è½½ `ai-travel-planner-image-<commit-sha>`ï¼ˆåŒ…å« `ai-travel-planner-<commit-sha>.tar`ï¼‰
- æœ¬åœ°åŠ è½½å¹¶è¿è¡Œï¼š

```bash
docker load -i ai-travel-planner-<commit-sha>.tar
# é•œåƒåç§°ä¸º <owner>/<repo>:<commit-sha>
# ä¾‹å¦‚ï¼šcodejoiffer/AI-Travel-Planner:<commit-sha>
docker run --env-file ./.env -p 3000:3000 <owner>/<repo>:<commit-sha>
```

å¦‚æœæ˜¯æ‰“äº† `v*` tag çš„æ„å»ºï¼Œè¿˜ä¼šåœ¨ GitHub Releases ä¸­é™„å¸¦é•œåƒ `.tar` æ–‡ä»¶ï¼Œæ— éœ€ç™»å½•å³å¯ä¸‹è½½ã€‚

## ğŸ³ GitHub Actions è‡ªåŠ¨åŒ–éƒ¨ç½²

é¡¹ç›®å·²é…ç½®å®Œæ•´çš„ CI/CD æµæ°´çº¿ï¼Œè‡ªåŠ¨æ„å»º Docker é•œåƒå¹¶æ¨é€åˆ°é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ï¼ˆACRï¼‰ã€‚

### é…ç½®æ­¥éª¤

1. **è®¾ç½® GitHub Secrets**ï¼šåœ¨ä»“åº“ Settings > Secrets and variables > Actions ä¸­æ·»åŠ ï¼š
   - `ACR_REGISTRY` - é˜¿é‡Œäº‘é•œåƒä»“åº“åœ°å€ï¼ˆå¦‚ï¼š`registry.cn-hangzhou.aliyuncs.com`ï¼‰
   - `ACR_NAMESPACE` - ä½ çš„å‘½åç©ºé—´
   - `ACR_USERNAME` - é˜¿é‡Œäº‘è´¦å·ç”¨æˆ·å
   - `ACR_PASSWORD` - é˜¿é‡Œäº‘è´¦å·å¯†ç æˆ–è®¿é—®ä»¤ç‰Œ

2. **è§¦å‘æ„å»º**ï¼š
   - æ¨é€ä»£ç åˆ° `main` æˆ– `master` åˆ†æ”¯
   - åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾ï¼ˆå¦‚ï¼š`git tag v1.0.0 && git push origin v1.0.0`ï¼‰
   - åœ¨ GitHub Actions é¡µé¢æ‰‹åŠ¨è§¦å‘å·¥ä½œæµ

### é•œåƒæ ‡ç­¾ç­–ç•¥

- **æäº¤å“ˆå¸Œæ ‡ç­¾**ï¼š`ai-travel-planner:${GITHUB_SHA}`
- **æœ€æ–°ç‰ˆæœ¬æ ‡ç­¾**ï¼š`ai-travel-planner:latest`ï¼ˆmain/master åˆ†æ”¯ï¼‰
- **ç‰ˆæœ¬æ ‡ç­¾**ï¼š`ai-travel-planner:v1.0.0`ï¼ˆtag å‘å¸ƒï¼‰

### æ‹‰å–å’Œè¿è¡Œé•œåƒ

```bash
# æ‹‰å–æœ€æ–°ç‰ˆæœ¬
docker pull ${ACR_REGISTRY}/${ACR_NAMESPACE}/ai-travel-planner:latest

# è¿è¡Œå®¹å™¨
docker run --env-file ./.env -p 3000:3000 \
  -e NEXT_PUBLIC_MAPS_API_KEY=your_key \
  -e NEXT_PUBLIC_SUPABASE_URL=your_url \
  -e NEXT_PUBLIC_SUPABASE_ANON_KEY=your_key \
  ${ACR_REGISTRY}/${ACR_NAMESPACE}/ai-travel-planner:latest
```

### é•œåƒä¸‹è½½ï¼ˆæ— éœ€ç™»å½•ï¼‰

æ¯æ¬¡ CI è¿è¡Œåï¼ŒGitHub Actions ä¼šç”Ÿæˆå¯ä¸‹è½½çš„é•œåƒæ–‡ä»¶ï¼š
- è¿›å…¥ä»“åº“ `Actions` â†’ é€‰æ‹©å·¥ä½œæµ â†’ `Artifacts`
- ä¸‹è½½ `ai-travel-planner-image-<commit-sha>`
- æœ¬åœ°åŠ è½½ï¼š`docker load -i ai-travel-planner-<commit-sha>.tar`
```

## Supabase æ•°æ®åº“è®¾ç½®

1. **åˆ›å»ºæ•°æ®åº“è¡¨**: è¿è¡Œæä¾›çš„è¿ç§»è„šæœ¬åˆ›å»º `trips` ä¸ `expenses` è¡¨
2. **å¯ç”¨é‚®ç®±éªŒè¯**: åœ¨ Supabase æ§åˆ¶å° > Authentication > Settings ä¸­é…ç½®é‚®ç®±è®¾ç½®
3. **é…ç½®ç¯å¢ƒå˜é‡**: ç¡®ä¿ `.env` æ–‡ä»¶åŒ…å«æ­£ç¡®çš„ Supabase URL å’ŒåŒ¿åå¯†é’¥

è¿ç§»è„šæœ¬ä½ç½®:

- è¡Œç¨‹ï¼š`supabase/migrations/001_create_trips_table.sql`
- è´¹ç”¨ï¼š`supabase/migrations/002_create_expenses_table.sql`

ä¸¤å¼ è¡¨å‡å·²å¯ç”¨ RLSï¼ˆè¡Œçº§å®‰å…¨ç­–ç•¥ï¼‰ï¼Œç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®ã€‚

## åç»­æ¥å…¥å»ºè®®

- å°† `/api/speech/recognize` æ¥å…¥ç§‘å¤§è®¯é£ SDK æˆ– HTTP APIã€‚
- å°† `/api/plan/create` æ¥å…¥é˜¿é‡Œäº‘ç™¾ç‚¼ LLMï¼Œå¹¶è¿”å›æ›´ç»†è‡´ã€å¯ç¼–è¾‘çš„è¡Œç¨‹ç»“æ„ï¼ˆå«ç»çº¬åº¦ï¼‰ã€‚
- ç”¨ Supabase Auth åšç™»å½•æ³¨å†Œï¼Œå¹¶ç”¨æ•°æ®åº“å­˜å‚¨ç”¨æˆ·è¡Œç¨‹ä¸åå¥½ã€‚
- æ·»åŠ è´¹ç”¨è®°å½•åŠŸèƒ½ï¼Œæ”¯æŒè¯­éŸ³è¾“å…¥å¼€é”€è®°å½•
- å®ç°å¤šè®¾å¤‡åŒæ­¥ï¼Œç¡®ä¿è¡Œç¨‹æ•°æ®äº‘ç«¯å¤‡ä»½

## æ‰¹æ”¹ç”¨å¯†é’¥ï¼ˆä½œä¸šè¦æ±‚ï¼‰

è‹¥æœªä½¿ç”¨é˜¿é‡Œäº‘çš„ API Keyï¼Œè¯·åœ¨æ­¤æä¾›ç”¨äºæ‰¹æ”¹çš„â€œä¸´æ—¶å¯†é’¥â€ï¼Œæœ‰æ•ˆæœŸè‡³å°‘ 3 ä¸ªæœˆï¼š

```
# ç¤ºä¾‹å ä½ï¼Œæäº¤å‰æ›¿æ¢ä¸ºçœŸå®å€¼ï¼ˆæˆ–æä¾›è·å–æ–¹å¼ï¼‰
LLM_API_KEY_FOR_GRADING=***
MAPS_API_KEY_FOR_GRADING=***
SPEECH_API_KEY_FOR_GRADING=***
SPEECH_API_SECRET_FOR_GRADING=***
```

æ³¨æ„ï¼šä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥ã€‚æ¨èåœ¨åº”ç”¨è®¾ç½®é¡µè¾“å…¥æˆ–é€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥ï¼›ä»…åœ¨ README çš„â€œæ‰¹æ”¹ç”¨å¯†é’¥â€åŒºåŸŸæŒ‰ä½œä¸šè¦æ±‚æä¾›è¯„æµ‹æ‰€éœ€ä¿¡æ¯ã€‚
